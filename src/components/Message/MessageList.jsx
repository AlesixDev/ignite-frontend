import { CircleNotch } from '@phosphor-icons/react';
import ChannelMessage from './ChannelMessage';

const MessageList = ({
    messages,
    pendingMessages,
    editingId,
    setEditingId,
    highlightId,
    guildId,
    isLoading,
    hasMore,
    atTop,
    loadingMore,
    onLoadMore
}) => {
    if (isLoading) {
        return <CircleNotch size={32} className="mx-auto animate-spin text-gray-500" />;
    }

    return (
        <>
            {atTop && hasMore && (
                <div className="sticky top-0 z-10 flex justify-center bg-gray-700/80 px-4 py-2 backdrop-blur">
                    <button
                        type="button"
                        onClick={onLoadMore}
                        disabled={loadingMore}
                        className="rounded bg-gray-800 px-3 py-1 text-xs text-gray-200 hover:bg-gray-700 disabled:opacity-60"
                    >
                        {loadingMore ? 'Loadingâ€¦' : 'Load history'}
                    </button>
                </div>
            )}

            {!hasMore && (
                <div className="px-4 py-2 text-center text-xs text-gray-500">
                    Beginning of channel
                </div>
            )}

            {messages?.map((message, index) => {
                const prevMessage = messages[index - 1] || null;
                return (
                    <div
                        key={message.id}
                        id={`msg-${message.id}`}
                        className={highlightId === message.id ? 'rounded ring-2 ring-primary' : ''}
                    >
                        <ChannelMessage
                            message={message}
                            prevMessage={prevMessage}
                            isEditing={editingId === message.id}
                            setEditingId={setEditingId}
                            guildId={guildId}
                        />
                    </div>
                );
            })}

            {pendingMessages?.map((message, index) => {
                const prevMessage = pendingMessages[index - 1] || messages[messages.length - 1] || null;
                return (
                    <ChannelMessage
                        key={message.nonce}
                        message={message}
                        prevMessage={prevMessage}
                        pending={true}
                        isEditing={false}
                        setEditingId={setEditingId}
                        guildId={guildId}
                    />
                );
            })}
        </>
    );
};

export default MessageList;
